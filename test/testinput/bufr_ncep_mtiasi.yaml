# (C) Copyright 2021 UCAR
#
# This software is licensed under the terms of the Apache Licence Version 2.0
# which can be obtained at http://www.apache.org/licenses/LICENSE-2.0.

observations:
  - obs space:
      name: bufr
      obsdatain: "test/testinput/gdas.mtiasi.t00z.20220216.bufr"

      exports:
        variables:
          # MetaData
          timestamp:
            datetime:
              year: "*/YEAR"
              month: "*/MNTH"
              day: "*/DAYS"
              hour: "*/HOUR"
              minute: "*/MINU"
              second: "*/SECO"

          latitude:
            query: "*/CLATH"

          longitude:
            query: "*/CLONH"

          satelliteId:
            query: "*/SAID"

          sensorId:
            query: "*/SIID[1]"

          scanLineNumber:
            query: "*/SLNM"

          gqisFlagQual:
            query: "*/QGFQ"

          fieldOfViewNumber:
            query: "*/FOVN"

          sensorScanPosition:
            sensorScanPosition:
              fieldOfViewNumber: "*/FOVN"
              sensor: iasi 

          solarZenithAngle:
            query: "*/SOZA"

          solarAzimuthAngle:
            query: "*/SOLAZI"

          sensorZenithAngle:
            query: "*/SAZA"

          sensorAzimuthAngle:
            query: "*/BEARAZ"

          stationElevation:
            query: "*/SELV"
            type: float 

          sensorViewAngle:
            sensorScanAngle:
              fieldOfViewNumber: "*/FOVN"
              scanStart: -48.330
              scanStep: 3.334
              scanStepAdjust: 0.625 
              sensor: iasi

          fractionOfClearPixelsInFOV:
            query: "*/IASIL1CS{1}/FCPH"
            type: float
            transforms:
               - scale: 0.01

          sensorChannelNumber:
            query: "*/IASICHN/CHNM"

          # ObsValue
          spectralRadiance:
            spectralRadiance:
              sensorChannelNumber: "*/IASICHN/CHNM"
              startChannel: "*/IASIL1CB/STCH"
              endChannel: "*/IASIL1CB/ENCH"
              scaleFactor: "*/IASIL1CB/CHSF"
              scaledSpectralRadiance: "*/IASICHN/SCRA"

        splits:
          satId:
            category:
              variable: satelliteId
              map:
                _3: metop-b
                _4: metop-a
                _5: metop-c

    ioda:
      backend: netcdf
      obsdataout: "./testrun/gdas.t12z.mtiasi_{splits/satId}.tm00.nc"

      dimensions:
        - name: Channel
          source: variables/sensorChannelNumber
          path: "*/IASICHN"

        - name: Cluster 
          path: "*/IASIL1CS"

        - name: Band 
          path: "*/IASIL1CB"

      globals:
        - name: "platformCommonName"
          type: string
          value: "Meteorological Operational Satellite"

        - name: "platformLongDescription"
          type: string
          value: "EUMETSAT Polar System in sunsynchronous orbit"

        - name: "source"
          type: string
          value: "MTYP 021-241 IASI 1C RADIANCES (VARIABLE CHNS) (METOP)"

        - name: "sourceFiles"
          type: string
          value: "gdas.t00z.mtiasi.tm00.bufr_d"

        - name: "datetimeReference"
          type: string
          value: "2021-08-01T00:00:00Z"

        - name: "sensor"
          type: string
          value: "IASI"

        - name: "processingLevel"
          type: string
          value: "Level-1C"

        - name: "sensorCentralWavenumber"
          type: floatVector
          value: [ 64875.0, 65200.0, 65275.0, 65350.0, 65425.0, 65500.0, 65575.0, 65650.0, 65700.0, 65725.0,
                   65750.0, 65800.0, 65850.0, 65875.0, 65900.0, 65950.0, 66000.0, 66025.0, 66050.0, 66125.0,
                   66175.0, 66225.0, 66275.0, 66325.0, 66375.0, 66425.0, 66450.0, 66500.0, 66525.0, 66550.0,
                   66575.0, 66600.0, 66625.0, 66650.0, 66700.0, 66775.0, 66800.0, 66850.0, 66900.0, 66950.0,
                   67000.0, 67050.0, 67075.0, 67125.0, 67200.0, 67225.0, 67250.0, 67300.0, 67375.0, 67450.0,
                   67525.0, 67600.0, 67675.0, 67750.0, 67800.0, 67850.0, 67925.0, 68000.0, 68075.0, 68125.0,
                   68175.0, 68225.0, 68250.0, 68325.0, 68400.0, 68450.0, 68475.0, 68500.0, 68550.0, 68650.0,
                   68725.0, 68800.0, 68875.0, 68950.0, 68975.0, 69100.0, 69150.0, 69250.0, 69300.0, 69400.0,
                   69450.0, 69475.0, 69525.0, 69550.0, 69600.0, 69650.0, 69725.0, 69775.0, 69800.0, 69825.0,
                   69900.0, 69925.0, 69950.0, 70025.0, 70075.0, 70100.0, 70125.0, 70175.0, 70225.0, 70250.0,
                   70275.0, 70375.0, 70400.0, 70450.0, 70550.0, 70625.0, 70700.0, 70775.0, 70825.0, 70950.0,
                   70975.0, 71025.0, 71100.0, 71150.0, 71200.0, 71350.0, 71450.0, 71525.0, 71600.0, 71825.0,
                   71875.0, 71950.0, 71975.0, 72050.0, 72125.0, 72200.0, 72300.0, 72475.0, 72550.0, 72625.0,
                   72650.0, 72700.0, 72775.0, 72850.0, 73100.0, 73150.0, 73225.0, 73325.0, 73375.0, 73475.0,
                   73550.0, 73625.0, 73750.0, 73775.0, 73800.0, 73850.0, 73900.0, 73950.0, 74000.0, 74050.0,
                   74125.0, 74200.0, 74425.0, 74500.0, 74575.0, 74600.0, 74650.0, 74675.0, 74725.0, 74750.0,
                   74825.0, 74875.0, 74925.0, 75050.0, 75125.0, 75175.0, 75275.0, 75300.0, 75325.0, 75450.0,
                   75525.0, 75600.0, 75725.0, 75900.0, 75950.0, 76275.0, 76400.0, 76550.0, 77200.0, 77350.0,
                   78125.0, 78275.0, 78450.0, 78625.0, 78750.0, 78800.0, 78925.0, 79075.0, 79325.0, 80100.0,
                   80625.0, 81025.0, 81175.0, 82100.0, 82950.0, 83375.0, 84400.0, 86150.0, 87125.0, 87500.0,
                   90150.0, 90625.0, 91725.0, 91925.0, 92500.0, 92800.0, 93800.0, 94250.0, 94325.0, 95025.0,
                   96250.0, 96550.0, 97925.0, 99700.0, 99825.0, 99975.0, 100075.0, 100150.0, 100225.0, 100325.0,
                   100475.0, 100525.0, 100600.0, 100725.0, 100825.0, 100975.0, 101050.0, 101200.0, 101325.0, 101450.0,
                   101550.0, 101650.0, 101825.0, 101875.0, 102025.0, 102100.0, 102200.0, 102225.0, 102300.0, 102425.0,
                   102500.0, 102625.0, 102700.0, 102775.0, 102875.0, 102900.0, 103000.0, 103100.0, 103175.0, 103300.0,
                   103475.0, 103675.0, 103825.0, 103950.0, 104050.0, 104100.0, 104150.0, 104625.0, 105125.0, 105450.0,
                   105550.0, 105775.0, 105925.0, 105950.0, 106125.0, 106250.0, 106350.0, 106500.0, 106825.0, 106900.0,
                   107225.0, 109125.0, 109250.0, 109600.0, 110450.0, 111575.0, 112300.0, 113125.0, 113150.0, 114250.0,
                   114950.0, 116825.0, 117450.0, 119800.0, 120450.0, 121250.0, 121700.0, 122500.0, 122800.0, 123125.0,
                   123200.0, 123275.0, 123450.0, 123650.0, 123825.0, 124425.0, 125125.0, 128525.0, 132000.0, 133000.0,
                   133100.0, 133475.0, 134950.0, 136700.0, 137150.0, 137225.0, 137450.0, 137500.0, 137950.0, 138075.0,
                   138100.0, 138175.0, 138250.0, 138425.0, 138750.0, 138900.0, 139100.0, 139175.0, 139225.0, 139250.0,
                   139300.0, 139525.0, 139675.0, 139825.0, 140150.0, 140200.0, 140225.0, 140375.0, 140650.0, 140700.0,
                   140775.0, 140800.0, 140850.0, 140925.0, 141075.0, 141200.0, 141650.0, 141800.0, 141925.0, 142100.0,
                   142150.0, 142225.0, 142375.0, 142650.0, 142700.0, 142875.0, 143125.0, 143250.0, 143475.0, 143600.0,
                   143675.0, 143850.0, 143925.0, 144200.0, 144650.0, 145175.0, 145575.0, 145675.0, 145775.0, 145875.0,
                   146050.0, 146500.0, 146850.0, 147050.0, 147200.0, 147275.0, 147525.0, 147625.0, 148325.0, 148625.0,
                   148850.0, 148925.0, 149750.0, 149875.0, 150275.0, 150425.0, 150475.0, 150525.0, 150575.0, 150625.0,
                   150675.0, 150725.0, 150775.0, 150825.0, 150925.0, 151150.0, 151375.0, 151575.0, 151750.0, 151900.0,
                   151950.0, 152075.0, 152125.0, 152200.0, 152425.0, 152650.0, 153350.0, 153850.0, 153900.0, 153975.0,
                   154025.0, 154125.0, 154200.0, 154450.0, 154725.0, 155125.0, 155425.0, 155625.0, 155800.0, 155925.0,
                   156000.0, 156300.0, 156700.0, 156975.0, 157225.0, 157625.0, 158550.0, 159825.0, 160500.0, 161675.0,
                   165275.0, 165950.0, 166175.0, 166525.0, 166850.0, 168475.0, 170325.0, 170900.0, 174750.0, 176925.0,
                   177475.0, 178275.0, 178650.0, 179675.0, 180625.0, 181925.0, 184675.0, 185700.0, 187475.0, 187950.0,
                   188150.0, 188650.0, 189250.0, 189375.0, 189850.0, 190175.0, 190875.0, 192675.0, 192725.0, 193075.0,
                   193725.0, 193925.0, 194050.0, 194175.0, 194250.0, 198675.0, 198750.0, 198950.0, 199000.0, 199050.0,
                   199400.0, 199450.0, 199500.0, 199550.0, 199600.0, 200625.0, 200850.0, 201275.0, 201475.0, 201550.0,
                   201600.0, 201775.0, 201900.0, 202025.0, 202150.0, 202200.0, 202400.0, 202675.0, 203425.0, 206900.0,
                   207325.0, 208200.0, 208625.0, 209100.0, 209425.0, 209450.0, 209500.0, 209900.0, 210300.0, 210325.0,
                   210375.0, 210700.0, 210750.0, 210775.0, 211100.0, 211200.0, 211500.0, 211575.0, 211900.0, 211975.0,
                   212375.0, 212775.0, 213175.0, 213550.0, 213675.0, 213925.0, 214175.0, 214275.0, 214325.0, 214400.0,
                   214550.0, 214675.0, 215050.0, 215125.0, 215450.0, 215800.0, 215875.0, 216150.0, 216250.0, 216525.0,
                   216600.0, 216925.0, 217275.0, 217625.0, 217850.0, 217975.0, 218200.0, 218325.0, 218425.0, 218500.0,
                   218675.0, 218825.0, 219025.0, 219150.0, 219600.0, 219700.0, 219800.0, 222400.0, 222950.0, 223025.0,
                   223625.0, 224000.0, 224250.0, 226700.0, 238525.0, 238625.0, 238725.0, 238850.0, 238900.0, 239025.0,
                   239100.0, 239150.0, 239200.0, 239250.0, 239300.0, 239350.0, 239400.0, 239450.0, 239475.0, 239575.0,
                   239675.0, 239800.0, 239875.0, 240000.0, 240075.0, 240150.0, 240200.0, 240275.0, 240425.0, 240550.0,
                   240625.0, 240700.0, 241200.0, 241275.0, 241375.0, 241500.0, 241575.0, 241700.0, 241950.0, 244700.0,
                   245025.0, 245250.0, 245350.0, 245650.0, 246150.0, 246200.0, 246575.0, 249200.0, 249950.0, 250050.0,
                   250075.0, 250125.0, 250175.0, 250250.0, 250375.0, 250575.0, 251350.0, 253200.0, 254075.0, 256100.0,
                   256125.0, 260250.0, 260375.0, 260800.0, 261100.0, 261600.0, 261675.0, 262275.0, 263225.0, 263775.0,
                   263975.0, 264350.0, 264650.0, 264850.0, 265850.0, 266425.0 ]

        - name: "converter"
          type: string
          value: "BUFR"

      variables:

        # MetaData 
        - name: "MetaData/dateTime"
          source: variables/timestamp
          longName: "Datetime"
          units: "seconds since 1970-01-01T00:00:00Z"

        - name: "MetaData/latitude"
          source: variables/latitude
          longName: "Latitude"
          units: "degrees_north"
          range: [ -90, 90 ]

        - name: "MetaData/longitude"
          source: variables/longitude
          longName: "Longitude"
          units: "degrees_east"
          range: [ -180, 180 ]

        - name: "MetaData/satelliteIdentifier"
          source: variables/satelliteId
          longName: "Satellite Identifier"

        - name: "MetaData/instrumentIdentifier"
          source: variables/sensorId
          longName: "Satellite Instrument Identifier"

        - name: "MetaData/scanLineNumber"
          source: variables/scanLineNumber
          longName: "Scan Line Number"

        - name: "MetaData/qualityFlags"
          source: variables/gqisFlagQual
          longName: "Individual IASI-System Quality Flag"

        - name: "MetaData/fieldOfViewNumber"
          source: variables/fieldOfViewNumber
          longName: "Field of View Number"

        - name: "MetaData/sensorScanPosition"
          source: variables/sensorScanPosition
          longName: "Sensor Scan Position"

        - name: "MetaData/solarZenithAngle"
          source: variables/solarZenithAngle
          longName: "Solar Zenith Angle"
          units: "degree"
          range: [ 0, 180 ]

        - name: "MetaData/solarAzimuthAngle"
          source: variables/solarAzimuthAngle
          longName: "Solar Azimuth Angle"
          units: "degree"
          range: [ 0, 360 ]

        - name: "MetaData/sensorCentralWavenumber"
          source: variables/sensorCentralWavenumber
          longName: "Central wave number"
          units: "m-1"
          range: [ 0, 1000000 ]

        - name: "MetaData/sensorZenithAngle"
          source: variables/sensorZenithAngle
          longName: "Sensor Zenith Angle"
          units: "degree"
          range: [ 0, 90 ]

        - name: "MetaData/sensorAzimuthAngle"
          source: variables/sensorAzimuthAngle
          longName: "Sensor Azimuth Angle"
          units: "degree"
          range: [ 0, 360 ]

        - name: "MetaData/sensorViewAngle"
          source: variables/sensorViewAngle
          longName: "Sensor View Angle"
          units: "degree"

        - name: "MetaData/stationElevation"
          source: variables/stationElevation
          longName: "Altitude of Satellite"
          units: "m"

        - name: "MetaData/sensorChannelNumber"
          source: variables/sensorChannelNumber
          longName: "Sensor Channel Number"

        - name: "MetaData/fractionOfClearPixelsInFOV"
          source: variables/fractionOfClearPixelsInFOV
          longName: "Fraction of Clear Pixels in a Field of View"
          units: "1"
          range: [0, 1]

#       The unit from BUFR is W m-2 sr-1 m -- this is radiance per wavenumber
#       - name: "ObsValue/spectralRadiance"
        - name: "ObsValue/radiance"
          source: variables/spectralRadiance
          longName: "IASI Spectral Radiance"
          units: "W m-2 sr-1"

